<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles_home.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
  <body style="background: url('{{ url_for('static', filename='assets/Background1.png') }}') no-repeat center center; background-size: cover;"">
    <!-- <div class="header" style="background: url('{{ url_for('static', filename='assets/Background1.png') }}') no-repeat center center; background-size: cover;"> -->
    <nav class="navbar">
        <div class="nav-left">
            <img src="{{ url_for('static', filename='assets/Logo.png') }}" alt="FlyDreamAir Logo" class="logo">
            <span class="logo-text">FlyDreamAir</span>
        </div>
        <div class="nav-center">
            <a href="#" class="nav-link">Home</a>
            <a href="#" class="nav-link">Flights</a>
            <a href="#" class="nav-link">Other Products</a>
            <a href="#" class="nav-link">Membership</a>
        </div>
        <div class="nav-right">
            <a href="#" class="nav-link">Support</a>
            <a href="/logout" class="nav-link">Log-out</a>
            <a href="#" class="nav-link">English</a>
        </div>
    </nav>
    <main class="main-container">
        <div class="card" style="width:75%; margin:50px auto; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,0.1);">
          <div class="card-header" style="background-color:#f8f9fa; border-bottom:1px solid #dee2e6; border-radius:10px 10px 0 0;">
            <div class="nav">
                <div class="active" onclick="show1()">BOOK FLIGHT</div>
                <div onclick="show2()">MANAGE RESERVATION</div>
                <div>CHECK-IN</div>
            </div>
          </div>
          <div class="card-body" style="height:auto; min-height:300px; padding:20px;" id="body">
            <!-- Content will be loaded by JavaScript -->
          </div>
        </div>
      </main>
      <div id="loader" class="loader"></div>
    <script>
        var cnt = 0;
        function show1(){
            
            if (cnt==0) {
                cnt += 1;
            }
            else{
                const navItems = document.querySelectorAll('.nav div');
                navItems.forEach(div => div.classList.remove('active'));
                event.target.classList.add('active');
            }
            
            document.getElementById("body").innerHTML = 
            '<div class="form-container">'
               + '<div class="radio-options">'
                +    '<label><input type="radio" name="trip" checked> Return</label>'
                +    '<label><input type="radio" name="trip"> One way</label>'
               + '</div>'

                +'<div class="row">'
                 +   '<input type="text" placeholder="From (e.g. SYD)" id="departPlace">'
                  +  '<div style="position: relative; flex: 1;">'
                   + '<input type="date" id="departDate" name="departDate" class="date-input" placeholder="Depart Date">'
                    +'</div>'
                +'</div>'

                +'<div class="row">'
                 +   '<input type="text" placeholder="To (e.g. MEL)" id="returnPlace">'
                  +  '<div style="position: relative; flex: 1;">'
                   +     '<input type="date" id="returnDate" name="returnDate" class="date-input" placeholder="Return Date">'

                   +' </div>'
                +'</div>'

                +'<div class="row">'
                    + '<select id="passenger"> ' +
                        '<option selected>Passenger</option> ' +
                        '<option>Adults</option> ' +
                        '<option>Children</option> ' +
                        '<option>Infants</option> ' +
                    '</select> ' 
                   
                   + '<input type="text" placeholder="Promotion code">'
                +'</div>'

                +'<div class="row" style="justify-content: flex-end;">'
                 +   '<button class="search-button" onclick="searchflight()">Search üîç</button>'
                +'</div>'
            +'</div>'       
        }
        window.onload = function() {
            show1();
        };
        function showLoader() {
            document.getElementById('loader').style.display = 'block';
        }

        function hideLoader() {
            document.getElementById('loader').style.display = 'none';
        }
        async function searchflight(){
            showLoader()
            const departPlace = document.getElementById("departPlace").value;
            const departDate = document.getElementById("departDate").value;
            const returnPlace = document.getElementById("returnPlace").value;
            const returnDate = document.getElementById("returnDate").value;
            const passenger= document.getElementById("passenger").value;
            console.log(departPlace, departDate, returnPlace, returnDate, passenger)
            const response = await fetch('/api/flight_search', {
                method:'POST',
                headers:{
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({departPlace, departDate, returnPlace, returnDate, passenger})
            })
            hideLoader()
            window.location.href = '/displaySearch'
        }

        async function show2(){
            const navItems = document.querySelectorAll('.nav div');
            navItems.forEach(div => div.classList.remove('active'));

            // Add 'active' to the clicked one
            event.target.classList.add('active');
            var display = 
            '<div class="d-flex flex-row">' + 
                '<div class="p-2">' + 
                    '<p>Booking number/ Reservation code</p>' + 
                    '<input type="text" id="bnumber">' + 
                '</div>' + 
                '<div class="p-2">' + 
                    '<p>Full Name</p>' + 
                    '<input type="text" id="surname">' + 
                '</div>' + 
                '<button class="p-2" onclick="showBooking()">Search</button>' + 
            '</div>' 
            + 'Your flights summary';

            const response = await fetch('/api/quick_user_flight_search');
            const answer = await response.json();
            console.log(answer);
            for (let i = 0; i < answer.length; i++){
                display +=  `<div style="display: flex; gap: 20px;">
                                <p><strong>Booking Number:</strong> ${answer[i][0]}</p>
                                <p><strong>Full Name:</strong> ${answer[i][1]}</p>
                            </div>`
            }
            document.getElementById("body").innerHTML = display;
        }
        function show3(){
            document.getElementById("body").innerHTML = '<p>Hello3</p>';
        }
        async function showBooking(){
            var bnumber = document.getElementById("bnumber").value;
            var surname = document.getElementById("surname").value;
            // console.log(bnumber, surname);
            const response = await fetch('/api/user_flight_search', {
                method:'POST',
                headers:{
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({bnumber, surname})
            })
            const answer = await response.json()
            console.log(answer)
            console.log(answer['airline'])
            const display = 
            '<div>' + 
                'Booking ' + answer['booking_number'] + 
            '</div>' + 
            '<div class="d-flex flex-row">' +
                '<div class="p-2">' + answer['depart_place'] + '<br/>' + answer['depart_time'] + '</div>' +
                '<div class="p-2">' + answer['arrive_place'] + '<br/>' + answer['arrive_time'] + '</div>' +
                '<div class="p-2">' + answer['airline'] + '<br/>' + answer['flight_number'] + '</div>' +
                '<div class="p-2">' + answer['fullname'] + '<br/>' + answer['passenger_num'] + ' passenger(s) ' + answer['flight_class'] + '</div>' +
                '<a class="p-2" href="/manage_booking"> Edit booking </a>' +
            '</div>'
            document.getElementById("body").innerHTML += display
            console.log(display)
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>
  </body>
</html>