<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Cart</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles_payment_1.css') }}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body onload="showCart()">
  <div class="container">
    <div class="top-bar">
      <a href="#" class="back-arrow">&larr; Back</a>
      <div class="currency">AUD</div>
      <button class="help-btn">HELP</button>
    </div>

    <h1>Your cart</h1>
    <div class="subtitle">
      <span class="cart-icon">&#128722;</span>
      Cart items
    </div>

    <!-- Dynamic content goes here -->
    <div id="display" class="cart-list"></div>

    <!-- Total will be appended by JS -->
    <div id="total" class="total-row"></div>

    <div class="action-row">
      <a class="btn btn-danger" href="/cancel">Cancel</a>
      <button id="confirm-btn" class="btn btn-primary" onclick="confirmCart()">Confirm</button>
    </div>
  </div>

  <script>
    let cartData = [];
    let seatData = [];

    async function showCart(){
        const response = await fetch('/api/payment_data');
        const answer = await response.json();

        let displayHTML = '';
        let totalPrice = 0;

        cartData = answer['cart'][0];
        seatData = answer['seats'][0];

        for(let item of answer['cart']){
            displayHTML += `
              <div class="cart-item">
                <span class="item-desc">${item[2]}</span>
                <span class="item-price">$${item[3]}</span>
              </div>`;
            totalPrice += item[3];
        }

        for(let seat of answer['seats']){
            displayHTML += `
              <div class="cart-item">
                <span class="item-desc">${seat[3]} - ${seat[1]} ${seat[2]}</span>
                <span class="item-price">$${seat[4]}</span>
              </div>`;
            totalPrice += seat[4];
        }

        document.getElementById('display').innerHTML = displayHTML;
        document.getElementById('total').innerHTML = `
            <span class="total-label">Total:</span>
            <span class="total-amount">$${totalPrice.toFixed(2)}</span>`;
    }

    async function confirmCart() {
      await fetch('/api/confirm_cart', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          cart: cartData,
          seats: seatData
        })
      });
      alert('Payment successfully');
      window.location.href = '/manage_booking';
    }
  </script>
</body>
</html>
